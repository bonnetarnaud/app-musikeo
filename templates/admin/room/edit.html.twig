{% extends 'app-layout/layout.html.twig' %}

{% block title %}Modifier {{ room.name }} - Salle{% endblock %}

{% block main_content %}
<div class="room-form-page">
    <!-- Header -->
    <div class="form-header">
        <div class="form-header-content">
            <div class="form-navigation">
                <a href="{{ path('app_room_show', {'id': room.id}) }}" class="back-link">
                    ‚Üê Retour √† la salle
                </a>
            </div>
            <div class="form-title-section">
                <h1 class="form-title">
                    <span class="form-icon">‚úèÔ∏è</span>
                    Modifier {{ room.name }}
                </h1>
                <p class="form-subtitle">
                    Modifiez les informations de la salle
                </p>
            </div>
            <div class="form-header-actions">
                <a href="{{ path('app_room_show', {'id': room.id}) }}" class="btn-outline">
                    üëÅÔ∏è Voir d√©tails
                </a>
            </div>
        </div>
    </div>

    <!-- Form Content -->
    <div class="form-content">
        <div class="form-container">
            {{ form_start(form, {'attr': {'class': 'room-form', 'novalidate': 'novalidate'}}) }}
            
            <!-- Basic Information Section -->
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">‚ÑπÔ∏è</span>
                        Informations de base
                    </h2>
                    <p class="section-description">
                        Modifiez les informations essentielles de la salle
                    </p>
                </div>
                
                <div class="form-grid">
                    <div class="form-group form-group-full">
                        {{ form_label(form.name, 'Nom de la salle *', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.name, {'attr': {'class': 'form-input', 'placeholder': 'Ex: Salle de piano A1'}}) }}
                        {{ form_errors(form.name) }}
                        <div class="form-help">
                            Nom unique et descriptif pour identifier cette salle
                        </div>
                    </div>
                    
                    <div class="form-group">
                        {{ form_label(form.capacity, 'Capacit√© *', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.capacity, {'attr': {'class': 'form-input', 'placeholder': 'Ex: 8'}}) }}
                        {{ form_errors(form.capacity) }}
                        <div class="form-help">
                            Nombre maximum de personnes (actuellement {{ room.capacity }})
                        </div>
                    </div>
                </div>
            </div>

            <!-- Location Section -->
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üìç</span>
                        Localisation et √©quipements
                    </h2>
                    <p class="section-description">
                        Mettez √† jour l'emplacement et les √©quipements disponibles
                    </p>
                </div>
                
                <div class="form-group">
                    {{ form_label(form.location, 'Description de la salle', {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.location, {'attr': {'class': 'form-textarea', 'placeholder': 'Ex: B√¢timent A, 1er √©tage, porte 101\n√âquip√©e d\'un piano droit Yamaha\nTableau, chaises, estrade', 'rows': 4}}) }}
                    {{ form_errors(form.location) }}
                    <div class="form-help">
                        Emplacement exact et √©quipements disponibles dans cette salle
                    </div>
                </div>
            </div>

            <!-- Current Usage Summary -->
            <div class="form-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üìä</span>
                        Utilisation actuelle
                    </h2>
                    <p class="section-description">
                        Aper√ßu de l'utilisation de cette salle
                    </p>
                </div>
                
                <div class="usage-summary">
                    <div class="usage-item">
                        <div class="usage-icon">üìÖ</div>
                        <div class="usage-content">
                            <div class="usage-title">Le√ßons programm√©es</div>
                            <div class="usage-value">{{ room.lessons|length }} le√ßon(s)</div>
                            {% if room.lessons|length > 0 %}
                                <div class="usage-detail">
                                    {% for lesson in room.lessons|slice(0, 3) %}
                                        <span class="usage-tag">
                                            {{ lesson.startDatetime|date('d/m') }} 
                                            {{ lesson.startDatetime|date('H:i') }}
                                        </span>
                                    {% endfor %}
                                    {% if room.lessons|length > 3 %}
                                        <span class="usage-more">+{{ room.lessons|length - 3 }}</span>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="usage-item">
                        <div class="usage-icon">
                            {% if room.lessons|length == 0 %}
                                üí§
                            {% elseif room.lessons|length < 5 %}
                                ‚úÖ
                            {% else %}
                                üî•
                            {% endif %}
                        </div>
                        <div class="usage-content">
                            <div class="usage-title">Statut d'utilisation</div>
                            <div class="usage-value">
                                {% if room.lessons|length == 0 %}
                                    Inutilis√©e
                                {% elseif room.lessons|length < 5 %}
                                    Disponible
                                {% else %}
                                    Tr√®s utilis√©e
                                {% endif %}
                            </div>
                            <div class="usage-detail">
                                {% if room.lessons|length == 0 %}
                                    <span class="usage-info">Aucune le√ßon programm√©e</span>
                                {% else %}
                                    <span class="usage-info">
                                        {{ ((room.lessons|length / 20) * 100)|round }}% d'utilisation estim√©e
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="usage-item">
                        <div class="usage-icon">‚è∞</div>
                        <div class="usage-content">
                            <div class="usage-title">Temps d'utilisation</div>
                            <div class="usage-value">
                                {% set totalHours = 0 %}
                                {% for lesson in room.lessons %}
                                    {% set duration = (lesson.endDatetime.timestamp - lesson.startDatetime.timestamp) / 3600 %}
                                    {% set totalHours = totalHours + duration %}
                                {% endfor %}
                                {{ totalHours|round(1) }}h total
                            </div>
                            {% if room.lessons|length > 0 %}
                                <div class="usage-detail">
                                    <span class="usage-info">
                                        {{ (totalHours / room.lessons|length)|round(1) }}h en moyenne par le√ßon
                                    </span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <div class="form-actions-content">
                    <a href="{{ path('app_room_show', {'id': room.id}) }}" class="btn-outline">
                        Annuler
                    </a>
                    <button type="submit" class="btn-primary">
                        <span class="btn-icon">üíæ</span>
                        Enregistrer les modifications
                    </button>
                </div>
            </div>

            {{ form_end(form) }}
        </div>

        <!-- Form Help -->
        <div class="form-sidebar">
            <div class="help-card">
                <div class="help-header">
                    <h3 class="help-title">‚ö†Ô∏è Attention</h3>
                </div>
                <div class="help-content">
                    {% if room.lessons|length > 0 %}
                        <div class="help-item">
                            <strong>Le√ßons programm√©es :</strong>
                            Cette salle a {{ room.lessons|length }} le√ßon(s) programm√©e(s). Les modifications n'affecteront pas les le√ßons existantes.
                        </div>
                    {% endif %}
                    <div class="help-item">
                        <strong>Changement de capacit√© :</strong>
                        V√©rifiez que les le√ßons existantes respectent toujours la nouvelle capacit√©.
                    </div>
                    {% if room.lessons|length == 0 %}
                        <div class="help-item">
                            <strong>Suppression possible :</strong>
                            Cette salle peut √™tre supprim√©e car elle n'a aucune le√ßon programm√©e.
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="help-card">
                <div class="help-header">
                    <h3 class="help-title">üîó Actions rapides</h3>
                </div>
                <div class="help-content">
                    <a href="{{ path('app_room_show', {'id': room.id}) }}" class="help-link">
                        üëÅÔ∏è Voir les d√©tails complets
                    </a>
                    <a href="{{ path('app_room_index') }}" class="help-link">
                        üè¢ Retour √† toutes les salles
                    </a>
                    {% if room.lessons|length == 0 %}
                        <div class="help-divider"></div>
                        <form method="post" action="{{ path('app_room_delete', {'id': room.id}) }}" class="help-form">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ room.id) }}">
                            <button type="submit" class="help-link help-link-danger" 
                                    onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cette salle ?')">
                                üóëÔ∏è Supprimer cette salle
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>

            <div class="help-card">
                <div class="help-header">
                    <h3 class="help-title">üí° Suggestions</h3>
                </div>
                <div class="help-content">
                    {% if room.capacity <= 5 %}
                        <div class="help-item">
                            <strong>Petite salle :</strong>
                            Id√©ale pour les cours individuels et les petits groupes.
                        </div>
                    {% elseif room.capacity <= 15 %}
                        <div class="help-item">
                            <strong>Salle moyenne :</strong>
                            Parfaite pour les ensembles et ateliers de groupe.
                        </div>
                    {% else %}
                        <div class="help-item">
                            <strong>Grande salle :</strong>
                            Adapt√©e aux orchestres et √©v√©nements importants.
                        </div>
                    {% endif %}
                    
                    {% if room.lessons|length == 0 %}
                        <div class="help-item">
                            <strong>Salle disponible :</strong>
                            Cette salle est libre pour de nouvelles programmations.
                        </div>
                    {% elseif room.lessons|length >= 10 %}
                        <div class="help-item">
                            <strong>Salle tr√®s utilis√©e :</strong>
                            Consid√©rez cr√©er une salle similaire si la demande est forte.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}