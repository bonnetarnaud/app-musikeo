{% extends 'app-layout/layout.html.twig' %}

{% block title %}{{ room.name }} - Salle{% endblock %}

{% block main_content %}
<div class="room-detail">
    <!-- Header -->
    <div class="room-detail-header">
        <div class="room-detail-header-content">
            <div class="room-detail-navigation">
                <a href="{{ path('app_room_index') }}" class="back-link">
                    ‚Üê Retour aux salles
                </a>
            </div>
            <div class="room-detail-title-section">
                <div class="room-detail-icon">
                    {% if room.capacity <= 5 %}
                        üö™
                    {% elseif room.capacity <= 15 %}
                        üè†
                    {% else %}
                        üè¢
                    {% endif %}
                </div>
                <div class="room-detail-info">
                    <h1 class="room-detail-title">{{ room.name }}</h1>
                    <div class="room-detail-subtitle">
                        Salle ‚Ä¢ {{ organization.name }}
                    </div>
                    <div class="room-detail-specs">
                        <span class="spec-capacity">üë• {{ room.capacity }} personnes</span>
                        {% if room.location %}
                            <span class="spec-location">üìç {{ room.location|split('\n')[0] }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="room-detail-actions">
                <a href="{{ path('app_room_edit', {'id': room.id}) }}" class="btn-primary">
                    ‚úèÔ∏è Modifier
                </a>
                <div class="dropdown">
                    <button class="dropdown-toggle btn-outline" data-dropdown-toggle="room-actions">
                        ‚ãÆ Actions
                    </button>
                    <div class="dropdown-menu" id="room-actions">
                        <a href="{{ path('app_room_edit', {'id': room.id}) }}" class="dropdown-item">
                            ‚úèÔ∏è Modifier la salle
                        </a>
                        <div class="dropdown-divider"></div>
                        <form method="post" action="{{ path('app_room_delete', {'id': room.id}) }}" class="dropdown-form">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ room.id) }}">
                            <button type="submit" class="dropdown-item dropdown-item-danger" 
                                    onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cette salle ?')">
                                üóëÔ∏è Supprimer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="room-detail-content">
        <!-- Overview Stats -->
        <div class="room-overview">
            <div class="overview-card">
                <div class="overview-icon">üë•</div>
                <div class="overview-content">
                    <div class="overview-number">{{ room.capacity }}</div>
                    <div class="overview-label">Capacit√©</div>
                </div>
            </div>
            <div class="overview-card">
                <div class="overview-icon">üìÖ</div>
                <div class="overview-content">
                    <div class="overview-number">{{ room.lessons|length }}</div>
                    <div class="overview-label">Le√ßons programm√©es</div>
                </div>
            </div>
            <div class="overview-card">
                <div class="overview-icon">üìä</div>
                <div class="overview-content">
                    <div class="overview-number">
                        {% if room.lessons|length == 0 %}
                            0%
                        {% else %}
                            {{ ((room.lessons|length / 20) * 100)|round }}%
                        {% endif %}
                    </div>
                    <div class="overview-label">Taux d'utilisation</div>
                </div>
            </div>
            <div class="overview-card">
                <div class="overview-icon">
                    {% if room.lessons|length == 0 %}
                        üí§
                    {% elseif room.lessons|length < 5 %}
                        ‚úÖ
                    {% else %}
                        üî•
                    {% endif %}
                </div>
                <div class="overview-content">
                    <div class="overview-number">
                        {% if room.lessons|length == 0 %}
                            Libre
                        {% elseif room.lessons|length < 5 %}
                            Dispo
                        {% else %}
                            Occup√©e
                        {% endif %}
                    </div>
                    <div class="overview-label">Statut</div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="room-detail-grid">
            <!-- Room Information -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">‚ÑπÔ∏è</span>
                        Informations de la salle
                    </h2>
                </div>
                <div class="section-content">
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Nom</label>
                            <div class="info-value">{{ room.name }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Capacit√©</label>
                            <div class="info-value">{{ room.capacity }} personnes</div>
                        </div>
                        <div class="info-item info-item-full">
                            <label class="info-label">Localisation / Description</label>
                            <div class="info-value">
                                {% if room.location %}
                                    {{ room.location|nl2br }}
                                {% else %}
                                    <span class="text-muted">Non renseign√©e</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lessons Schedule -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üìÖ</span>
                        Planning des le√ßons ({{ room.lessons|length }})
                    </h2>
                </div>
                <div class="section-content">
                    {% if room.lessons|length > 0 %}
                        <div class="lessons-list">
                            {% for lesson in room.lessons|slice(0, 10) %}
                                <div class="lesson-item">
                                    <div class="lesson-info">
                                        <div class="lesson-title">
                                            {% if lesson.course %}
                                                {{ lesson.course.name }}
                                            {% else %}
                                                Le√ßon individuelle
                                            {% endif %}
                                        </div>
                                        <div class="lesson-details">
                                            <span class="lesson-datetime">
                                                üïê {{ lesson.startDatetime|date('d/m/Y H:i') }}
                                                - {{ lesson.endDatetime|date('H:i') }}
                                            </span>
                                            {% if lesson.course and lesson.course.teacher %}
                                                <span class="lesson-teacher">
                                                    üë©‚Äçüè´ {{ lesson.course.teacher.fullName }}
                                                </span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="lesson-status">
                                        {% set lessonDate = lesson.startDatetime|date('Y-m-d') %}
                                        {% set today = 'now'|date('Y-m-d') %}
                                        {% if lessonDate == today %}
                                            <span class="status-badge status-today">üìç Aujourd'hui</span>
                                        {% elseif lessonDate > today %}
                                            <span class="status-badge status-upcoming">‚è∞ √Ä venir</span>
                                        {% else %}
                                            <span class="status-badge status-past">‚úÖ Pass√©e</span>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                            {% if room.lessons|length > 10 %}
                                <div class="lessons-more">
                                    <span class="text-muted">+ {{ room.lessons|length - 10 }} autres le√ßons</span>
                                </div>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="empty-state-small">
                            <div class="empty-icon-small">üìÖ</div>
                            <div class="empty-text">Aucune le√ßon programm√©e</div>
                            <div class="empty-help">Cette salle est disponible pour de nouvelles le√ßons</div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Usage Statistics -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üìä</span>
                        Statistiques d'utilisation
                    </h2>
                </div>
                <div class="section-content">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-icon">üìÖ</div>
                            <div class="stat-content">
                                <div class="stat-number">{{ room.lessons|length }}</div>
                                <div class="stat-label">Le√ßons totales</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">‚è∞</div>
                            <div class="stat-content">
                                <div class="stat-number">
                                    {% set totalHours = 0 %}
                                    {% for lesson in room.lessons %}
                                        {% set duration = (lesson.endDatetime.timestamp - lesson.startDatetime.timestamp) / 3600 %}
                                        {% set totalHours = totalHours + duration %}
                                    {% endfor %}
                                    {{ totalHours|round(1) }}h
                                </div>
                                <div class="stat-label">Temps total</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-content">
                                <div class="stat-number">
                                    {% if room.lessons|length > 0 %}
                                        {{ (totalHours / room.lessons|length)|round(1) }}h
                                    {% else %}
                                        0h
                                    {% endif %}
                                </div>
                                <div class="stat-label">Dur√©e moyenne</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-content">
                                <div class="stat-number">
                                    {% if room.lessons|length == 0 %}
                                        Libre
                                    {% elseif room.lessons|length < 3 %}
                                        Faible
                                    {% elseif room.lessons|length < 8 %}
                                        Mod√©r√©e
                                    {% else %}
                                        √âlev√©e
                                    {% endif %}
                                </div>
                                <div class="stat-label">Utilisation</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">‚ö°</span>
                        Actions rapides
                    </h2>
                </div>
                <div class="section-content">
                    <div class="actions-grid">
                        <a href="{{ path('app_room_edit', {'id': room.id}) }}" class="action-card">
                            <div class="action-icon">‚úèÔ∏è</div>
                            <div class="action-content">
                                <div class="action-title">Modifier la salle</div>
                                <div class="action-description">Changer nom, capacit√© ou localisation</div>
                            </div>
                        </a>
                        
                        <div class="action-card action-disabled">
                            <div class="action-icon">üìÖ</div>
                            <div class="action-content">
                                <div class="action-title">Programmer une le√ßon</div>
                                <div class="action-description">R√©server cette salle (bient√¥t disponible)</div>
                            </div>
                        </div>
                        
                        <div class="action-card action-disabled">
                            <div class="action-icon">üìä</div>
                            <div class="action-content">
                                <div class="action-title">Voir le planning complet</div>
                                <div class="action-description">Calendrier d√©taill√© (bient√¥t disponible)</div>
                            </div>
                        </div>
                        
                        {% if room.lessons|length == 0 %}
                            <form method="post" action="{{ path('app_room_delete', {'id': room.id}) }}" class="action-card action-danger">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ room.id) }}">
                                <button type="submit" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cette salle ?')" class="action-button">
                                    <div class="action-icon">üóëÔ∏è</div>
                                    <div class="action-content">
                                        <div class="action-title">Supprimer la salle</div>
                                        <div class="action-description">Suppression d√©finitive</div>
                                    </div>
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}