{% extends 'app-layout/layout.html.twig' %}

{% block title %}{{ student.fullName }} - Ã‰lÃ¨ve{% endblock %}

{% block main_content %}
<div class="student-detail">
    <!-- Header -->
    <div class="student-detail-header">
        <div class="student-detail-header-content">
            <div class="student-detail-navigation">
                <a href="{{ path('app_student_index') }}" class="back-link">
                    â† Retour aux Ã©lÃ¨ves
                </a>
            </div>
            <div class="student-detail-title-section">
                <div class="student-detail-avatar">
                    {{ student.firstname|first|upper }}{{ student.lastname|first|upper }}
                </div>
                <div class="student-detail-info">
                    <h1 class="student-detail-title">{{ student.fullName }}</h1>
                    <div class="student-detail-subtitle">
                        Ã‰lÃ¨ve â€¢ {{ organization.name }}
                    </div>
                    <div class="student-detail-contact">
                        <span class="contact-email">ğŸ“§ {{ student.email }}</span>
                        {% if student.phone %}
                            <span class="contact-phone">ğŸ“ {{ student.phone }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="student-detail-actions">
                <a href="{{ path('app_student_edit', {'id': student.id}) }}" class="btn-primary">
                    âœï¸ Modifier
                </a>
                <div class="dropdown">
                    <button class="dropdown-toggle btn-outline" data-dropdown-toggle="student-actions">
                        â‹® Actions
                    </button>
                    <div class="dropdown-menu" id="student-actions">
                        <a href="{{ path('app_student_edit', {'id': student.id}) }}" class="dropdown-item">
                            âœï¸ Modifier l'Ã©lÃ¨ve
                        </a>
                        <div class="dropdown-divider"></div>
                        <form method="post" action="{{ path('app_student_delete', {'id': student.id}) }}" class="dropdown-form">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ student.id) }}">
                            <button type="submit" class="dropdown-item dropdown-item-danger" 
                                    onclick="return confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cet Ã©lÃ¨ve ?')">
                                ğŸ—‘ï¸ Supprimer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="student-detail-content">
        <!-- Overview Stats -->
        <div class="student-overview">
            <div class="overview-card">
                <div class="overview-icon">ğŸ“š</div>
                <div class="overview-content">
                    <div class="overview-number">{{ student.enrollments|length }}</div>
                    <div class="overview-label">Cours inscrits</div>
                </div>
            </div>
            <div class="overview-card">
                <div class="overview-icon">ğŸµ</div>
                <div class="overview-content">
                    <div class="overview-number">{{ student.instrumentRentals|length }}</div>
                    <div class="overview-label">Instruments louÃ©s</div>
                </div>
            </div>
            <div class="overview-card">
                <div class="overview-icon">ğŸ’°</div>
                <div class="overview-content">
                    <div class="overview-number">{{ student.payments|length }}</div>
                    <div class="overview-label">Paiements</div>
                </div>
            </div>
            <div class="overview-card">
                <div class="overview-icon">ğŸ‚</div>
                <div class="overview-content">
                    <div class="overview-number">
                        {% if student.dateOfBirth %}
                            {{ 'now'|date('Y') - student.dateOfBirth|date('Y') }}
                        {% else %}
                            -
                        {% endif %}
                    </div>
                    <div class="overview-label">Ã‚ge</div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="student-detail-grid">
            <!-- Personal Information -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">ğŸ‘¤</span>
                        Informations personnelles
                    </h2>
                </div>
                <div class="section-content">
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">PrÃ©nom</label>
                            <div class="info-value">{{ student.firstname }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Nom</label>
                            <div class="info-value">{{ student.lastname }}</div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Email</label>
                            <div class="info-value">
                                <a href="mailto:{{ student.email }}" class="email-link">{{ student.email }}</a>
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">TÃ©lÃ©phone</label>
                            <div class="info-value">
                                {% if student.phone %}
                                    <a href="tel:{{ student.phone }}" class="phone-link">{{ student.phone }}</a>
                                {% else %}
                                    <span class="text-muted">Non renseignÃ©</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <label class="info-label">Date de naissance</label>
                            <div class="info-value">
                                {% if student.dateOfBirth %}
                                    {{ student.dateOfBirth|date('d/m/Y') }}
                                    <span class="text-muted">({{ 'now'|date('Y') - student.dateOfBirth|date('Y') }} ans)</span>
                                {% else %}
                                    <span class="text-muted">Non renseignÃ©e</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item info-item-full">
                            <label class="info-label">Adresse</label>
                            <div class="info-value">
                                {% if student.address %}
                                    {{ student.address|nl2br }}
                                {% else %}
                                    <span class="text-muted">Non renseignÃ©e</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enrollments -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">ğŸ“š</span>
                        Inscriptions aux cours ({{ student.enrollments|length }})
                    </h2>
                </div>
                <div class="section-content">
                    {% if student.enrollments|length > 0 %}
                        <div class="enrollments-list">
                            {% for enrollment in student.enrollments %}
                                <div class="enrollment-item">
                                    <div class="enrollment-info">
                                        <div class="enrollment-course">{{ enrollment.course.name }}</div>
                                        <div class="enrollment-details">
                                            <span class="enrollment-schedule">
                                                ğŸ• {{ enrollment.course.dayOfWeek|title }} {{ enrollment.course.startTime|date('H:i') }}
                                            </span>
                                            <span class="enrollment-teacher">
                                                ğŸ‘©â€ğŸ« {{ enrollment.course.teacher.fullName }}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="enrollment-status">
                                        <span class="status-badge status-{{ enrollment.status }}">
                                            {% if enrollment.status == 'valide' %}
                                                âœ… ValidÃ©
                                            {% elseif enrollment.status == 'en_attente' %}
                                                â³ En attente
                                            {% elseif enrollment.status == 'annule' %}
                                                âŒ AnnulÃ©
                                            {% else %}
                                                {{ enrollment.status }}
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-state-small">
                            <div class="empty-icon-small">ğŸ“š</div>
                            <div class="empty-text">Aucune inscription</div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Instrument Rentals -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">ğŸµ</span>
                        Locations d'instruments ({{ student.instrumentRentals|length }})
                    </h2>
                </div>
                <div class="section-content">
                    {% if student.instrumentRentals|length > 0 %}
                        <div class="rentals-list">
                            {% for rental in student.instrumentRentals %}
                                <div class="rental-item">
                                    <div class="rental-info">
                                        <div class="rental-instrument">{{ rental.instrument.name }}</div>
                                        <div class="rental-details">
                                            <span class="rental-dates">
                                                ğŸ“… Du {{ rental.startDate|date('d/m/Y') }}
                                                {% if rental.endDate %}
                                                    au {{ rental.endDate|date('d/m/Y') }}
                                                {% else %}
                                                    (en cours)
                                                {% endif %}
                                            </span>
                                            <span class="rental-price">
                                                ğŸ’° {{ rental.monthlyPrice }}â‚¬/mois
                                            </span>
                                        </div>
                                    </div>
                                    <div class="rental-status">
                                        <span class="status-badge status-{{ rental.status }}">
                                            {% if rental.status == 'active' %}
                                                âœ… Active
                                            {% elseif rental.status == 'ended' %}
                                                ğŸ”š TerminÃ©e
                                            {% elseif rental.status == 'cancelled' %}
                                                âŒ AnnulÃ©e
                                            {% else %}
                                                {{ rental.status }}
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-state-small">
                            <div class="empty-icon-small">ğŸµ</div>
                            <div class="empty-text">Aucune location</div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Payments -->
            <div class="detail-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">ğŸ’°</span>
                        Historique des paiements ({{ student.payments|length }})
                    </h2>
                </div>
                <div class="section-content">
                    {% if student.payments|length > 0 %}
                        <div class="payments-list">
                            {% for payment in student.payments|slice(0, 5) %}
                                <div class="payment-item">
                                    <div class="payment-info">
                                        <div class="payment-amount">{{ payment.amount }}â‚¬</div>
                                        <div class="payment-details">
                                            <span class="payment-date">ğŸ“… {{ payment.paymentDate|date('d/m/Y') }}</span>
                                            <span class="payment-method">
                                                {% if payment.paymentMethod == 'card' %}
                                                    ğŸ’³ Carte bancaire
                                                {% elseif payment.paymentMethod == 'transfer' %}
                                                    ğŸ¦ Virement
                                                {% elseif payment.paymentMethod == 'cash' %}
                                                    ğŸ’µ EspÃ¨ces
                                                {% elseif payment.paymentMethod == 'check' %}
                                                    ğŸ“‹ ChÃ¨que
                                                {% else %}
                                                    {{ payment.paymentMethod }}
                                                {% endif %}
                                            </span>
                                        </div>
                                    </div>
                                    <div class="payment-status">
                                        <span class="status-badge status-{{ payment.status }}">
                                            {% if payment.status == 'confirmed' %}
                                                âœ… ConfirmÃ©
                                            {% elseif payment.status == 'pending' %}
                                                â³ En attente
                                            {% elseif payment.status == 'failed' %}
                                                âŒ Ã‰chouÃ©
                                            {% else %}
                                                {{ payment.status }}
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            {% endfor %}
                            {% if student.payments|length > 5 %}
                                <div class="payments-more">
                                    <span class="text-muted">+ {{ student.payments|length - 5 }} autres paiements</span>
                                </div>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="empty-state-small">
                            <div class="empty-icon-small">ğŸ’°</div>
                            <div class="empty-text">Aucun paiement</div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}